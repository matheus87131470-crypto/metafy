<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Metafy - An√°lise inteligente de partidas de futebol com IA">
    <meta name="theme-color" content="#0f0f1a">
    <title>Metafy ‚Äî An√°lise Inteligente de Futebol</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öΩ</text></svg>">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    
    <!-- Styles (deploy ping) -->
    <link rel="stylesheet" href="src/styles/theme.css">
    <link rel="stylesheet" href="src/styles/cards.css">
    <link rel="stylesheet" href="src/styles/premium.css">
    <link rel="stylesheet" href="src/styles/filters.css">
    <link rel="stylesheet" href="src/styles/premium-analysis.css">
    <link rel="stylesheet" href="src/styles/pix-payment.css">
    
    <style>
        /* Header */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(15, 15, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 0;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .logo-text {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-purple);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* User Menu */
        .user-menu {
            position: relative;
        }

        .user-menu-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .user-menu-btn:hover {
            background: var(--bg-elevated);
            border-color: var(--accent-purple);
        }

        .user-avatar {
            font-size: 1.2rem;
        }

        .user-name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .user-arrow {
            font-size: 0.8rem;
            color: var(--text-muted);
            transition: transform var(--transition-normal);
        }

        .user-menu.active .user-arrow {
            transform: rotate(180deg);
        }

        /* Dropdown */
        .user-dropdown {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 220px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dropdown-premium-badge {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .premium-badge-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--gradient-purple);
            border-radius: var(--radius-md);
            color: white;
            font-weight: 600;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all var(--transition-normal);
            border: none;
            background: transparent;
            width: 100%;
            text-align: left;
            cursor: pointer;
        }

        .dropdown-item:hover:not(.dropdown-item-disabled) {
            background: rgba(139, 92, 246, 0.1);
            color: var(--accent-purple);
        }

        .dropdown-item:first-child {
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }

        .dropdown-item:last-child {
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        .dropdown-item-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .dropdown-item-danger {
            color: #ef4444;
        }

        .dropdown-item-danger:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .item-icon {
            font-size: 1.1rem;
            width: 20px;
            text-align: center;
        }

        .item-badge {
            margin-left: auto;
            padding: 2px 8px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: var(--radius-sm);
            font-size: 0.7rem;
            color: var(--accent-purple);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0;
        }


        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 8px;
            padding: 0 16px;
            max-width: 1200px;
            margin: 0 auto;
            margin-top: 16px;
        }

        .nav-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--bg-secondary);
            border: 1px solid transparent;
            border-radius: var(--radius-md);
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            transition: all var(--transition-normal);
        }

        .nav-tab:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .nav-tab.active {
            background: var(--gradient-purple);
            color: white;
            border-color: var(--accent-purple);
        }

        .nav-tab .tab-icon {
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 16px;
        }

        /* Section Header */
        .section-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .section-subtitle {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Footer */
        .app-footer {
            text-align: center;
            padding: 32px 16px;
            margin-top: 48px;
            border-top: 1px solid var(--border-light);
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--text-secondary);
        }

        .empty-state p {
            font-size: 1.1rem;
        }

        /* Premium tab content */
        .premium-content {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
            padding: 48px 24px;
        }

        .premium-hero-icon {
            font-size: 5rem;
            margin-bottom: 24px;
        }

        .premium-hero-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 16px;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .premium-hero-subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 32px;
        }

        /* Auth Buttons & User Dropdown */
        .auth-buttons {
            position: relative;
        }

        .btn-google {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: white;
            color: #3c4043;
            border: 1px solid #dadce0;
            border-radius: var(--radius-lg);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-normal);
            font-family: var(--font-sans);
        }

        .btn-google:hover {
            background: #f8f9fa;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .user-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 14px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .user-btn:hover {
            background: var(--bg-elevated);
            border-color: var(--accent-purple);
        }

        .user-photo {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            object-fit: cover;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            min-width: 260px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            z-index: 1000;
            animation: slideDown 0.2s ease;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .dropdown-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .dropdown-name {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .dropdown-email {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .logout-item {
            color: #ef4444 !important;
        }

        .logout-item:hover {
            background: rgba(239, 68, 68, 0.1) !important;
        }

        /* Games List Container */
        #gamesList {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            padding: 0 8px;
        }

        /* Match Cards - Sistema Profissional */
        .match-card {
            background: linear-gradient(145deg, #0a1628, #132337);
            border-radius: 20px;
            padding: 0;
            margin-bottom: 16px;
            position: relative;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            border: 1px solid rgba(59, 130, 246, 0.15);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .match-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.4);
        }

        .match-card.locked {
            filter: blur(4px);
            pointer-events: none;
            opacity: 0.6;
        }

        .match-card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.9), rgba(236, 72, 153, 0.9));
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            z-index: 10;
            backdrop-filter: blur(10px);
        }

        .match-card-overlay .lock-icon {
            font-size: 3rem;
        }

        .match-card-overlay .unlock-text {
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
        }

        .match-card-overlay .btn-premium {
            padding: 12px 24px;
            background: white;
            color: #8b5cf6;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.3s;
        }

        .match-card-overlay .btn-premium:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.3);
        }

        .match-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .league {
            color: #94a3b8;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .match-time {
            color: #3b82f6;
            font-size: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .teams {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 20px;
        }

        .team {
            font-size: 15px;
            font-weight: 700;
            color: white;
        }

        .vs-separator {
            color: #475569;
            font-size: 11px;
            font-weight: 700;
            padding: 0 8px;
        }

        .prediction-box {
            padding: 24px;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .prediction-box.high {
            border-left: 4px solid #10b981;
        }

        .prediction-box.medium {
            border-left: 4px solid #f59e0b;
        }

        .prediction-box.low {
            border-left: 4px solid #ef4444;
        }

        .confidence {
            font-size: 36px;
            font-weight: 900;
            margin-bottom: 8px;
        }

        .confidence.high {
            background: linear-gradient(135deg, #10b981, #34d399);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .confidence.medium {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .confidence.low {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .label {
            font-size: 10px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .market {
            font-size: 14px;
            font-weight: 700;
            color: white;
            background: rgba(59, 130, 246, 0.15);
            padding: 8px 16px;
            border-radius: 8px;
            display: inline-block;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        /* Paywall Visual */
        .match-card.locked {
            position: relative;
            filter: blur(3px);
            pointer-events: none;
        }

        .match-card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.85), rgba(88, 28, 135, 0.9));
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            z-index: 10;
            pointer-events: all;
        }

        .lock-icon {
            font-size: 48px;
            margin-bottom: 12px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        .unlock-text {
            text-align: center;
            color: white;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .btn-premium {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #1a1a1a;
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 215, 0, 0.5);
        }

        .match-stats {
            display: flex;
            gap: 12px;
            margin: 15px 0;
            font-size: 13px;
        }

        .stat-item {
            flex: 1;
            background: rgba(139, 92, 246, 0.1);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 11px;
            margin-bottom: 4px;
        }

        .stat-value {
            color: var(--accent-purple);
            font-weight: 600;
        }

        .buttons {
            display: flex;
            gap: 12px;
            padding: 20px;
        }

        .btn-stats, .btn-ai {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-stats {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-stats:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.5);
        }

        .btn-ai {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-ai:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.5);
        }

        .btn-ai:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ========================================
           BLOCO DE PREVIS√ÉO EXPAND√çVEL
        ======================================== */
        .prediction-block {
            background: rgba(0, 0, 0, 0.4);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding: 0;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .prediction-block.expanded {
            max-height: 800px;
            opacity: 1;
            padding: 24px;
        }

        .prediction-main {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            gap: 20px;
        }

        .prediction-content {
            flex: 1;
        }

        .prediction-market {
            font-size: 11px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .prediction-pick {
            font-size: 22px;
            font-weight: 800;
            color: white;
            margin-bottom: 16px;
        }

        .prediction-badge {
            background: linear-gradient(135deg, #10b981, #34d399);
            padding: 16px 20px;
            border-radius: 12px;
            text-align: center;
            min-width: 140px;
            border: 2px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .prediction-badge.medium {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            border-color: rgba(245, 158, 11, 0.3);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
        }

        .prediction-badge.low {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: rgba(239, 68, 68, 0.3);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
        }

        .badge-pct {
            font-size: 28px;
            font-weight: 900;
            color: white;
            margin-bottom: 4px;
        }

        .badge-label {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 700;
        }

        .prediction-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .prediction-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-action-stats {
            background: rgba(16, 185, 129, 0.15);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .btn-action-stats:hover {
            background: rgba(16, 185, 129, 0.25);
            border-color: #10b981;
        }

        .btn-action-ai {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .btn-action-ai:hover {
            background: rgba(59, 130, 246, 0.25);
            border-color: #3b82f6;
        }

        .other-predictions {
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding-top: 16px;
        }

        .other-predictions-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 8px 0;
            user-select: none;
        }

        .other-predictions-title {
            font-size: 13px;
            font-weight: 700;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .other-predictions-toggle {
            font-size: 12px;
            color: #64748b;
            transition: transform 0.3s;
        }

        .other-predictions-toggle.active {
            transform: rotate(180deg);
        }

        .other-predictions-list {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .other-predictions-list.expanded {
            max-height: 400px;
            margin-top: 12px;
        }

        .other-prediction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .other-prediction-label {
            font-size: 13px;
            color: #cbd5e1;
            font-weight: 600;
        }

        .other-prediction-pct {
            font-size: 14px;
            font-weight: 700;
            color: #3b82f6;
        }

        /* Responsive do Bloco Expand√≠vel */
        @media (max-width: 640px) {
            .prediction-main {
                flex-direction: column;
            }

            .prediction-badge {
                width: 100%;
            }

            .prediction-actions {
                flex-direction: column;
            }
        }

        /* Fim do Bloco Expand√≠vel */

        /* Responsive */
        @media (max-width: 640px) {
            .header-content {
                flex-direction: row;
                justify-content: space-between;
            }

            .header-right {
                gap: 8px;
            }

            .user-name {
                display: none;
            }

            .user-dropdown {
                right: 0;
                left: auto;
            }

            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }

            .nav-tab {
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .dropdown-menu {
                right: 0;
                left: auto;
            }

            /* Match Cards Responsive */
            .match-card {
                padding: 16px;
            }

            .teams {
                padding-right: 0;
                margin-bottom: 120px;
            }

            .prediction-box {
                position: static;
                margin: 15px auto;
                width: 100%;
                max-width: 200px;
            }

            .team {
                font-size: 16px;
            }

            .buttons {
                flex-direction: column;
            }

            .btn-stats, .btn-ai {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">‚öΩ</span>
                <span class="logo-text">Metafy</span>
            </div>
            <div class="header-right">
                <div class="analysis-counter" id="analysisCounter">
                    ‚ö° 2/2 an√°lises restantes
                </div>
                
                <!-- Auth Buttons (Google Firebase) -->
                <div class="auth-buttons" id="authButtons">
                    <button class="btn-google" onclick="loginWithGoogle()">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
                        Entrar com Google
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="games" onclick="switchTab('games')">
            <span class="tab-icon">‚öΩ</span>
            <span>Jogos</span>
        </button>
        <button class="nav-tab" data-tab="balance" onclick="switchTab('balance')">
            <span class="tab-icon">üìä</span>
            <span>Ganhos/Perdas</span>
        </button>
        <button class="nav-tab" data-tab="premium" onclick="switchTab('premium')">
            <span class="tab-icon">üíé</span>
            <span>Premium</span>
        </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Tab: Jogos -->
        <div class="tab-content active" id="tab-games">
            <div class="section-header">
                <h2 class="section-title">‚öΩ Jogos de Hoje</h2>
                <p class="section-subtitle">Selecione um jogo para analisar com IA</p>
            </div>
            
            <!-- Filtros -->
            <div id="filtersContainer"></div>
            
            <!-- Lista de Jogos -->
            <div id="gamesList"></div>
        </div>

        <!-- Tab: Ganhos/Perdas -->
        <div class="tab-content" id="tab-balance">
            <!-- Formul√°rio Nova Sess√£o -->
            <div class="session-form-card" style="background: var(--bg-card); border-radius: 16px; padding: 24px; margin-bottom: 24px; border: 1px solid var(--border-color);">
                <h3 style="font-size: 1.2rem; margin-bottom: 20px; color: var(--text-primary);">üí∞ Nova Sess√£o</h3>
                
                <div style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary);">
                        <span style="color: #10b981;">‚úì</span>
                        Ganhos (R$)
                    </label>
                    <input type="number" id="input-ganhos" placeholder="0.00" step="0.01" min="0" 
                           style="width: 100%; padding: 12px 16px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 1rem;">
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-secondary);">
                        <span style="color: #ef4444;">‚úï</span>
                        Perdas (R$)
                    </label>
                    <input type="number" id="input-perdas" placeholder="0.00" step="0.01" min="0"
                           style="width: 100%; padding: 12px 16px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-size: 1rem;">
                </div>

                <button type="button" onclick="adicionarSessao()" 
                        style="width: 100%; padding: 14px; background: var(--gradient-purple); color: white; border: none; border-radius: 10px; font-weight: 600; font-size: 1rem; cursor: pointer;">
                    ‚úö Adicionar Sess√£o
                </button>
            </div>

            <!-- Progresso da Meta -->
            <div style="background: var(--bg-card); border-radius: 16px; padding: 24px; margin-bottom: 24px; border: 1px solid var(--border-color);">
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; margin-bottom: 24px;">
                    <h3 style="font-size: 1.1rem; color: var(--text-primary);">üéØ Progresso da Meta (Ciclo #<span id="ciclo-numero">1</span>)</h3>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button onclick="editarMeta()" style="padding: 8px 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-secondary); font-size: 0.8rem; cursor: pointer;">‚úèÔ∏è Editar Meta</button>
                        <button onclick="finalizarCiclo()" style="padding: 8px 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-secondary); font-size: 0.8rem; cursor: pointer;">üèÅ Finalizar Ciclo</button>
                        <button onclick="resetTotal()" style="padding: 8px 12px; background: var(--bg-secondary); border: 1px solid #ef4444; border-radius: 6px; color: #ef4444; font-size: 0.8rem; cursor: pointer;">üóëÔ∏è Reset</button>
                    </div>
                </div>

                <!-- Gauge Circular -->
                <div style="text-align: center; margin-bottom: 24px;">
                    <svg viewBox="0 0 200 140" style="max-width: 280px; margin: 0 auto; display: block;">
                        <defs>
                            <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <path d="M 30 110 A 70 70 0 0 1 170 110" fill="none" stroke="rgba(139, 92, 246, 0.2)" stroke-width="14" stroke-linecap="round"/>
                        <path id="gauge-arc" d="M 30 110 A 70 70 0 0 1 170 110" fill="none" stroke="url(#gaugeGradient)" stroke-width="14" stroke-linecap="round" style="stroke-dasharray: 220; stroke-dashoffset: 220; transition: stroke-dashoffset 0.5s ease;"/>
                    </svg>
                    
                    <div style="margin-top: -80px; position: relative;">
                        <div style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px;">Total Acumulado</div>
                        <div style="font-size: 2rem; font-weight: 700; background: linear-gradient(135deg, #8b5cf6, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            R$ <span id="gauge-total">0,00</span>
                        </div>
                        <div style="font-size: 1.5rem; font-weight: 600; color: #ec4899;">
                            <span id="gauge-percentage">0</span>%
                        </div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">
                            Meta: R$ <span id="gauge-goal">2.000,00</span>
                        </div>
                    </div>
                </div>

                <!-- Cards de resultado -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-top: 40px;">
                    <div style="background: var(--bg-secondary); border-left: 3px solid #10b981; border-radius: 8px; padding: 16px;">
                        <div style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Resultado Atual</div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: #10b981;">R$ <span id="gauge-current">0,00</span></div>
                    </div>
                    <div style="background: var(--bg-secondary); border-left: 3px solid #ec4899; border-radius: 8px; padding: 16px;">
                        <div style="font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 8px;">Meta Definida</div>
                        <div style="font-size: 1.4rem; font-weight: 700; color: #ec4899;">R$ <span id="gauge-goal-value">2.000,00</span></div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px; font-size: 0.9rem; color: var(--text-secondary);">
                    Faltam <strong style="color: #ec4899;">R$ <span id="gauge-missing">2.000,00</span></strong> para sua meta
                </div>
            </div>

            <!-- Gr√°ficos -->
            <div style="display: grid; gap: 24px; margin-bottom: 24px;">
                <div style="background: var(--bg-card); border-radius: 16px; padding: 24px; border: 1px solid var(--border-color);">
                    <h3 style="font-size: 1rem; margin-bottom: 16px; color: var(--text-primary);">üìà Evolu√ß√£o do Lucro</h3>
                    <div style="height: 200px;">
                        <canvas id="chartLucro"></canvas>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 0.85rem; color: var(--text-secondary);">
                        <span id="lucro-date">--</span>
                        <span style="color: #10b981;">Lucro: R$ <span id="lucro-value">0,00</span></span>
                    </div>
                </div>

                <div style="background: var(--bg-card); border-radius: 16px; padding: 24px; border: 1px solid var(--border-color);">
                    <h3 style="font-size: 1rem; margin-bottom: 16px; color: var(--text-primary);">üìä Evolu√ß√£o da Stake</h3>
                    <div style="height: 200px;">
                        <canvas id="chartStake"></canvas>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 12px; font-size: 0.85rem; color: var(--text-secondary);">
                        <span id="stake-date">--</span>
                        <span style="color: #10b981;">Total: <span id="stake-value">0</span> stakes</span>
                    </div>
                </div>
            </div>

            <!-- Estat√≠sticas -->
            <div style="background: var(--bg-card); border-radius: 16px; padding: 24px; border: 1px solid var(--border-color);">
                <h3 style="font-size: 1rem; margin-bottom: 16px; color: var(--text-primary);">üìã Estat√≠sticas</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;">
                    <div style="background: var(--bg-secondary); border-radius: 10px; padding: 16px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 4px;">üíé</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">Odd M√©dia</div>
                        <div style="font-size: 1.2rem; font-weight: 600; color: var(--text-primary);" id="stat-odd">0.00</div>
                    </div>
                    <div style="background: var(--bg-secondary); border-radius: 10px; padding: 16px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 4px;">#</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">Total Apostas</div>
                        <div style="font-size: 1.2rem; font-weight: 600; color: var(--text-primary);" id="stat-total">0</div>
                    </div>
                    <div style="background: var(--bg-secondary); border-radius: 10px; padding: 16px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 4px;">‚úì</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">Ganhos</div>
                        <div style="font-size: 1.2rem; font-weight: 600; color: #10b981;" id="stat-wins">0</div>
                    </div>
                    <div style="background: var(--bg-secondary); border-radius: 10px; padding: 16px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 4px;">‚úï</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px;">Perdas</div>
                        <div style="font-size: 1.2rem; font-weight: 600; color: #ef4444;" id="stat-losses">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab: Premium -->
        <div class="tab-content" id="tab-premium">
            <div class="premium-content">
                <div class="premium-hero-icon">üíé</div>
                <h2 class="premium-hero-title">Metafy Premium</h2>
                <p class="premium-hero-subtitle">Desbloqueie todo o potencial da an√°lise com IA</p>
                
                <div class="feature-comparison">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Recurso</th>
                                <th>Free</th>
                                <th class="premium-col">Premium üíé</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>An√°lises de IA</td>
                                <td>2/dia</td>
                                <td class="premium-col">‚àû Ilimitado</td>
                            </tr>
                            <tr>
                                <td>Estat√≠sticas b√°sicas</td>
                                <td>‚úÖ</td>
                                <td class="premium-col">‚úÖ</td>
                            </tr>
                            <tr>
                                <td>Probabilidades</td>
                                <td>‚úÖ</td>
                                <td class="premium-col">‚úÖ</td>
                            </tr>
                            <tr>
                                <td>Previs√µes detalhadas</td>
                                <td>‚ùå</td>
                                <td class="premium-col">‚úÖ</td>
                            </tr>
                            <tr>
                                <td>Over/Under</td>
                                <td>‚ùå</td>
                                <td class="premium-col">‚úÖ</td>
                            </tr>
                            <tr>
                                <td>Ambas Marcam</td>
                                <td>‚ùå</td>
                                <td class="premium-col">‚úÖ</td>
                            </tr>
                            <tr>
                                <td>Insights IA</td>
                                <td>‚ùå</td>
                                <td class="premium-col">‚úÖ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="premium-price-section">
                    <div class="price-card">
                        <span class="price-label">Pagamento via PIX</span>
                        <div class="price-amount">
                            <span class="currency">R$</span>
                            <span class="value" id="premiumPriceDisplay">4,50</span>
                        </div>
                        <span class="price-duration">7 dias de acesso ‚Ä¢ Libera√ß√£o autom√°tica ‚Ä¢ Sem renova√ß√£o</span>
                    </div>
                </div>

                <button class="btn-premium-cta" id="premiumCtaBtn" onclick="activatePremium()" style="margin-top: 24px;">
                    üíé Pagar R$ 4,50 via PIX
                </button>
                <p style="text-align: center; color: var(--text-muted); font-size: 0.85rem; margin-top: 12px;">Pagamento PIX ‚Ä¢ Libera√ß√£o autom√°tica ‚Ä¢ 7 dias de acesso</p>
                
                <!-- Status Premium (vis√≠vel apenas para usu√°rios Premium) -->
                <div id="premiumStatus" style="display: none; margin-top: 24px; padding: 20px; background: rgba(16, 185, 129, 0.1); border: 1px solid var(--accent-green); border-radius: 12px;">
                    <h4 style="color: var(--accent-green); margin-bottom: 12px;">‚úÖ Voc√™ √© Premium!</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">Seu acesso expira em: <strong id="premiumExpiry">--</strong></p>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de Pagamento PIX (DEPRECADO - agora usa Mercado Pago Checkout Pro) -->
    <!-- Este modal n√£o √© mais usado, mantido apenas para compatibilidade -->
    <div id="pixPaymentModal" class="modal-overlay" style="display: none;">
        <div class="modal-content pix-modal">
            <button class="modal-close" onclick="closePixModal()">&times;</button>
            
            <div id="pixForm" class="pix-form">
                <h2 class="modal-title">üíé Assinar Premium</h2>
                <p class="modal-subtitle">Redirecionando para Mercado Pago...</p>
                
                <div class="pix-amount">
                    <span class="currency">R$</span>
                    <span class="value">3,50</span>
                </div>
                <p class="pix-description">7 dias de acesso Premium</p>
                
                <div class="form-group">
                    <label for="emailInput">Email</label>
                    <input 
                        type="email" 
                        id="emailInput" 
                        class="form-input" 
                        placeholder="seu@email.com"
                        autocomplete="email"
                    >
                    <span id="emailError" class="input-error" style="display: none;">Email inv√°lido</span>
                </div>
                
                <div class="form-group">
                    <label for="cpfInput">CPF (somente n√∫meros)</label>
                    <input 
                        type="text" 
                        id="cpfInput" 
                        class="form-input" 
                        placeholder="Digite seu CPF (11 d√≠gitos)"
                        maxlength="14"
                        autocomplete="off"
                    >
                    <span id="cpfError" class="input-error" style="display: none;">CPF deve ter 11 d√≠gitos</span>
                </div>
                
                <button class="btn-premium-cta" onclick="generatePixPayment()">
                    Gerar Pagamento PIX
                </button>
            </div>
            
            <div id="pixLoading" class="pix-loading" style="display: none;">
                <div class="spinner"></div>
                <p>Gerando pagamento PIX...</p>
            </div>
            
            <div id="pixContent" style="display: none;">
                <h2 class="modal-title">üí≥ Pagamento PIX</h2>
                <p class="modal-subtitle">Escaneie o QR Code ou copie o c√≥digo</p>
                
                <div class="pix-amount">
                    <span class="currency">R$</span>
                    <span class="value" class="pix-price-value">4,50</span>
                </div>
                <p class="pix-description">7 dias de acesso Premium</p>
                
                <div class="qr-container">
                    <img id="qrCodeImage" src="" alt="QR Code PIX" class="qr-code">
                </div>
                
                <div class="pix-code-section">
                    <label>C√≥digo PIX Copia e Cola:</label>
                    <textarea id="pixCode" readonly class="pix-code-input"></textarea>
                    <button class="btn-copy" onclick="copyPixCode()">üìã Copiar C√≥digo</button>
                </div>
                
                <div class="pix-status">
                    <div class="status-checking">
                        <div class="pulse-dot"></div>
                        <span>Aguardando pagamento...</span>
                    </div>
                </div>
                
                <p class="pix-info">O pagamento ser√° confirmado automaticamente em alguns segundos.</p>
            </div>
            
            <div id="pixSuccess" style="display: none;">
                <div class="success-icon">‚úÖ</div>
                <h2 class="modal-title">Premium Ativado!</h2>
                <p class="modal-subtitle">Seu acesso foi liberado com sucesso</p>
                <button class="btn-premium-cta" onclick="closePixModal(); updatePremiumStatusUI();">Come√ßar a Usar</button>
            </div>
            
            <div id="pixError" style="display: none;">
                <div class="error-icon">‚ùå</div>
                <h2 class="modal-title">Erro ao Gerar Pagamento</h2>
                <p class="modal-subtitle" id="errorMessage">Tente novamente em alguns instantes</p>
                <button class="btn-secondary" onclick="resetPixModal()">Tentar Novamente</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="app-footer">
        <p>Metafy ¬© 2026 | An√°lise Inteligente de Futebol</p>
    </footer>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- UI Components -->
    <script src="src/ui/LeagueFilter.js"></script>
    <script src="src/ui/LeagueGames.js"></script>
    <script src="src/ui/PremiumAnalysis.js"></script>
    
    <script>
        // Evitar que o app.js sobrescreva o login do Firebase
        window.USE_FIREBASE_AUTH = true;
    </script>

    <!-- Mock Games Data -->
    <script src="src/data/mockGames.js"></script>

    <!-- App Script -->
    <script src="src/app.js"></script>
    
    <script>
        // Tab switching
        function switchTab(tabId) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabId);
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `tab-${tabId}`);
            });

            // Inicializar gr√°ficos ao trocar para balance
            if (tabId === 'balance') {
                setTimeout(() => initCharts(), 100);
            }
            
            // Atualizar status premium ao trocar para premium
            if (tabId === 'premium') {
                updatePremiumStatusUI();
            }
        }

        function showPremiumInfo() {
            switchTab('premium');
        }
        
        // User Menu Functions
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            const menu = document.querySelector('.user-menu');
            
            if (dropdown.style.display === 'none') {
                dropdown.style.display = 'block';
                menu.classList.add('active');
            } else {
                dropdown.style.display = 'none';
                menu.classList.remove('active');
            }
        }

        function closeUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            const menu = document.querySelector('.user-menu');
            dropdown.style.display = 'none';
            menu.classList.remove('active');
        }

        function showAccountSection() {
            alert('‚öôÔ∏è Se√ß√£o de Conta em desenvolvimento!');
            closeUserMenu();
        }

        function showAnalyzerSection() {
            switchTab('games');
            closeUserMenu();
        }

        // Fun√ß√£o de logout removida - usando a do app.js

        // Fechar dropdown ao clicar fora
        document.addEventListener('click', (e) => {
            const userMenu = document.querySelector('.user-menu');
            if (userMenu && !userMenu.contains(e.target)) {
                closeUserMenu();
            }
        });

        // Atualizar badge premium no dropdown
        function updateUserMenuPremiumBadge() {
            const premiumBadge = document.getElementById('dropdownPremiumBadge');
            if (typeof isPremiumUser === 'function' && isPremiumUser()) {
                if (premiumBadge) {
                    premiumBadge.style.display = 'block';
                }
            } else {
                if (premiumBadge) {
                    premiumBadge.style.display = 'none';
                }
            }
        }

        // Chamar ao carregar p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                updateUserMenuPremiumBadge();
            }, 500);
        });

        
        // Atualizar UI do status Premium na aba Premium
        function updatePremiumStatusUI() {
            const statusDiv = document.getElementById('premiumStatus');
            const expirySpan = document.getElementById('premiumExpiry');
            const ctaButton = document.querySelector('#tab-premium .btn-premium-cta');
            
            if (typeof isPremiumUser === 'function' && isPremiumUser()) {
                const data = getPremiumData();
                const premiumEnd = new Date(data.premium_end);
                
                if (statusDiv) {
                    statusDiv.style.display = 'block';
                }
                if (expirySpan) {
                    expirySpan.textContent = premiumEnd.toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
                if (ctaButton) {
                    ctaButton.textContent = '‚úÖ Premium Ativo';
                    ctaButton.disabled = true;
                    ctaButton.style.background = 'var(--accent-green)';
                }
            } else {
                if (statusDiv) {
                    statusDiv.style.display = 'none';
                }
                if (ctaButton) {
                    ctaButton.textContent = 'üíé Pagar R$ 4,50 via PIX';
                    ctaButton.disabled = false;
                    ctaButton.style.background = '';
                }
            }
        }

        // ====================================
        // SISTEMA DE SESS√ïES E METAS
        // ====================================
        const STORAGE_KEY = 'metafy_balance_data';
        let chartLucro = null;
        let chartStake = null;

        function getBalanceData() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : {
                meta: 2000,
                ciclo: 1,
                sessoes: [],
                totalGanhos: 0,
                totalPerdas: 0,
                saldo: 0
            };
        }

        function saveBalanceData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            atualizarInterface();
            atualizarGraficos();
        }

        function adicionarSessao() {
            const ganhos = parseFloat(document.getElementById('input-ganhos').value) || 0;
            const perdas = parseFloat(document.getElementById('input-perdas').value) || 0;

            if (ganhos === 0 && perdas === 0) {
                alert('‚ö†Ô∏è Adicione pelo menos um valor (ganhos ou perdas)');
                return;
            }

            const data = getBalanceData();
            
            const sessao = {
                id: Date.now(),
                data: new Date().toISOString(),
                ganhos,
                perdas,
                resultado: ganhos - perdas
            };

            data.sessoes.push(sessao);
            data.totalGanhos += ganhos;
            data.totalPerdas += perdas;
            data.saldo = data.totalGanhos - data.totalPerdas;

            saveBalanceData(data);

            document.getElementById('input-ganhos').value = '';
            document.getElementById('input-perdas').value = '';

            alert('‚úÖ Sess√£o adicionada com sucesso!');
        }

        function atualizarInterface() {
            const data = getBalanceData();
            const percentual = Math.min((data.saldo / data.meta) * 100, 100);
            const faltam = Math.max(100 - percentual, 0);
            const faltaValor = Math.max(data.meta - data.saldo, 0);

            // Atualizar valores
            const el = (id) => document.getElementById(id);
            if (el('gauge-total')) el('gauge-total').textContent = data.saldo.toFixed(2).replace('.', ',');
            if (el('gauge-percentage')) el('gauge-percentage').textContent = percentual.toFixed(0);
            if (el('gauge-goal')) el('gauge-goal').textContent = data.meta.toFixed(2).replace('.', ',');
            if (el('gauge-goal-value')) el('gauge-goal-value').textContent = data.meta.toFixed(2).replace('.', ',');
            if (el('gauge-current')) el('gauge-current').textContent = data.saldo.toFixed(2).replace('.', ',');
            if (el('gauge-missing')) el('gauge-missing').textContent = faltaValor.toFixed(2).replace('.', ',');
            if (el('ciclo-numero')) el('ciclo-numero').textContent = data.ciclo;

            // Animar gauge
            const offset = 220 - (220 * percentual / 100);
            const gaugeArc = document.getElementById('gauge-arc');
            if (gaugeArc) gaugeArc.style.strokeDashoffset = offset;

            // Estat√≠sticas
            const sessoes = data.sessoes || [];
            const totalGanhos = sessoes.filter(s => s.ganhos > 0).length;
            const totalPerdas = sessoes.filter(s => s.perdas > 0).length;
            const oddMedia = sessoes.length > 0 ? (data.totalGanhos / sessoes.length).toFixed(2) : '0.00';

            if (el('stat-odd')) el('stat-odd').textContent = oddMedia;
            if (el('stat-total')) el('stat-total').textContent = sessoes.length;
            if (el('stat-wins')) el('stat-wins').textContent = totalGanhos;
            if (el('stat-losses')) el('stat-losses').textContent = totalPerdas;
        }

        function editarMeta() {
            const data = getBalanceData();
            const novaMeta = prompt('üí∞ Nova meta (R$):', data.meta);
            if (novaMeta && !isNaN(novaMeta) && parseFloat(novaMeta) > 0) {
                data.meta = parseFloat(novaMeta);
                saveBalanceData(data);
                alert('‚úÖ Meta atualizada!');
            }
        }

        function finalizarCiclo() {
            if (!confirm('üèÅ Finalizar ciclo atual e iniciar novo?')) return;
            
            const data = getBalanceData();
            data.ciclo++;
            data.sessoes = [];
            data.totalGanhos = 0;
            data.totalPerdas = 0;
            data.saldo = 0;
            
            saveBalanceData(data);
            alert('‚úÖ Ciclo #' + data.ciclo + ' iniciado!');
        }

        function resetTotal() {
            if (!confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso apagar√° TODOS os dados. Confirmar?')) return;
            
            localStorage.removeItem(STORAGE_KEY);
            atualizarInterface();
            atualizarGraficos();
            alert('üóëÔ∏è Todos os dados foram resetados.');
        }

        function initCharts() {
            if (chartLucro) chartLucro.destroy();
            if (chartStake) chartStake.destroy();

            const data = getBalanceData();
            const sessoes = data.sessoes || [];

            // Processar dados do lucro
            let lucroAcumulado = 0;
            const lucroLabels = sessoes.length > 0 ? [] : ['In√≠cio'];
            const lucroValues = sessoes.length > 0 ? [] : [0];

            sessoes.forEach(sessao => {
                const d = new Date(sessao.data);
                lucroLabels.push(`${d.getDate()}/${d.getMonth() + 1}`);
                lucroAcumulado += sessao.resultado;
                lucroValues.push(lucroAcumulado);
            });

            // Processar dados da stake
            let stakeAcumulado = 0;
            const stakeLabels = sessoes.length > 0 ? [] : ['In√≠cio'];
            const stakeValues = sessoes.length > 0 ? [] : [0];

            sessoes.forEach(sessao => {
                const d = new Date(sessao.data);
                stakeLabels.push(`${d.getDate()}/${d.getMonth() + 1}`);
                stakeAcumulado += 1;
                stakeValues.push(stakeAcumulado);
            });

            // Atualizar info
            if (sessoes.length > 0) {
                const lastDate = new Date(sessoes[sessoes.length - 1].data);
                const el = (id) => document.getElementById(id);
                if (el('lucro-date')) el('lucro-date').textContent = `${lastDate.getDate()}/${lastDate.getMonth() + 1}`;
                if (el('lucro-value')) el('lucro-value').textContent = lucroAcumulado.toFixed(2).replace('.', ',');
                if (el('stake-date')) el('stake-date').textContent = `${lastDate.getDate()}/${lastDate.getMonth() + 1}`;
                if (el('stake-value')) el('stake-value').textContent = stakeAcumulado;
            }

            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(139, 92, 246, 0.1)' }, ticks: { color: '#a0a0b2', font: { size: 10 } } },
                    y: { grid: { color: 'rgba(139, 92, 246, 0.1)' }, ticks: { color: '#a0a0b2', font: { size: 10 } } }
                }
            };

            const ctxLucro = document.getElementById('chartLucro');
            if (ctxLucro) {
                chartLucro = new Chart(ctxLucro, {
                    type: 'line',
                    data: {
                        labels: lucroLabels,
                        datasets: [{
                            data: lucroValues,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#10b981',
                            pointRadius: 4
                        }]
                    },
                    options: commonOptions
                });
            }

            const ctxStake = document.getElementById('chartStake');
            if (ctxStake) {
                chartStake = new Chart(ctxStake, {
                    type: 'line',
                    data: {
                        labels: stakeLabels,
                        datasets: [{
                            data: stakeValues,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#8b5cf6',
                            pointRadius: 4
                        }]
                    },
                    options: commonOptions
                });
            }
        }

        function atualizarGraficos() {
            initCharts();
        }

        // Inicializar dados ao carregar
        document.addEventListener('DOMContentLoaded', () => {
            atualizarInterface();
        });
    </script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

    <script>
        // Configura√ß√£o do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDXBuFVzWmqaawKtO5j24OaQGbFCjpTcFc",
            authDomain: "metafy-1a1d4.firebaseapp.com",
            projectId: "metafy-1a1d4",
            storageBucket: "metafy-1a1d4.firebasestorage.app",
            messagingSenderId: "393535115679",
            appId: "1:393535115679:web:c1cda095fb08399695adaa"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Estado global do usu√°rio (Firebase)
        let firebaseCurrentUser = null;
        let firebaseUserToken = null;
        let firebaseUserStatus = null;

        // URL do backend (evitar redeclara√ß√£o global)
        const backendUrl = window.BACKEND_URL || 'https://metafy-backend.onrender.com';

        // Fun√ß√£o helper para fazer requests autenticados
        async function authenticatedFetch(url, options = {}) {
            if (!firebaseUserToken) {
                throw new Error('Usu√°rio n√£o autenticado');
            }

            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${firebaseUserToken}`,
                ...(options.headers || {})
            };

            const response = await fetch(url, {
                ...options,
                headers
            });

            if (response.status === 401) {
                // Token expirado - fazer novo login
                console.log('üîÑ Token expirado, atualizando...');
                await updateUserToken();
                
                // Tentar novamente com novo token
                headers.Authorization = `Bearer ${firebaseUserToken}`;
                return fetch(url, { ...options, headers });
            }

            return response;
        }

        // Atualizar token do usu√°rio
        async function updateUserToken() {
            if (auth.currentUser) {
                firebaseUserToken = await auth.currentUser.getIdToken(true);
                console.log('üîë Token atualizado');
            }
        }

        // Buscar status do usu√°rio do backend
        async function fetchUserStatus() {
            try {
                const response = await authenticatedFetch(`${backendUrl}/api/user/status`);
                const data = await response.json();
                
                if (data.success) {
                    firebaseUserStatus = data;
                    console.log('üìä Status do usu√°rio:', data);
                    updateStatusUI(data);
                }
            } catch (error) {
                console.error('‚ùå Erro ao buscar status:', error);
            }
        }

        // Atualizar UI com status
        function updateStatusUI(status) {
            // Atualizar contador de an√°lises restantes
            const statusElement = document.querySelector('.user-status');
            if (statusElement) {
                const remaining = status.remainingToday;
                const isPremium = status.isPremium;
                
                statusElement.innerHTML = isPremium 
                    ? 'üíé Premium - An√°lises Ilimitadas'
                    : `üÜì ${remaining} an√°lises restantes hoje`;
            }
        }

        // Validar e registrar uso de an√°lise
        async function validateAndUseAnalysis() {
            try {
                const response = await authenticatedFetch(`${backendUrl}/api/user/analysis/use`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    if (data.code === 'DAILY_LIMIT') {
                        // Calcular hor√°rio de reset
                        const resetAt = data.resetAt ? new Date(data.resetAt) : null;
                        const resetTime = resetAt ? resetAt.toLocaleTimeString('pt-BR', { 
                            hour: '2-digit', 
                            minute: '2-digit',
                            timeZone: 'America/Sao_Paulo'
                        }) : '00:00';
                        
                        const message = `‚ö†Ô∏è LIMITE DI√ÅRIO ATINGIDO\n\n` +
                            `Voc√™ j√° usou suas ${data.usedToday || 2} an√°lises gratuitas de hoje.\n\n` +
                            `üïê Volta amanh√£ √†s ${resetTime} (hor√°rio de Bras√≠lia)\n\n` +
                            `üíé OU fa√ßa upgrade para Premium e tenha an√°lises ILIMITADAS!`;
                        
                        alert(message);
                        // TODO: Mostrar modal premium com bot√£o de upgrade
                        return false;
                    }
                    throw new Error(data.error);
                }
                
                // Atualizar status local
                firebaseUserStatus = data;
                updateStatusUI(data);
                
                console.log(`‚úÖ An√°lise autorizada: ${data.usedToday}/${data.isPremium ? '‚àû' : '2'} usadas (${data.remainingToday} restantes)`);
                return true;
                
            } catch (error) {
                console.error('‚ùå Erro ao validar an√°lise:', error);
                alert('Erro ao validar an√°lise: ' + error.message);
                return false;
            }
        }

        // Fun√ß√£o de login com Google
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();

            auth.signInWithPopup(provider)
                .then(async (result) => {
                    console.log('‚úÖ Usu√°rio logado:', result.user.email);
                    firebaseCurrentUser = result.user;

                    // Obter token
                    firebaseUserToken = await result.user.getIdToken();
                    console.log('üîë Token obtido');

                    // Buscar status do backend
                    await fetchUserStatus();
                })
                .catch(async (error) => {
                    console.error('‚ùå Erro no login:', error.code, error.message);

                    // Popup bloqueado ou ambiente sem popup -> tentar redirect
                    if (
                        error.code === 'auth/popup-blocked' ||
                        error.code === 'auth/cancelled-popup-request' ||
                        error.code === 'auth/operation-not-supported-in-this-environment'
                    ) {
                        try {
                            await auth.signInWithRedirect(provider);
                            return;
                        } catch (redirectError) {
                            console.error('‚ùå Erro no redirect:', redirectError.code, redirectError.message);
                        }
                    }

                    if (error.code === 'auth/unauthorized-domain') {
                        alert('Dom√≠nio n√£o autorizado no Firebase. Adicione metafy.store e www.metafy.store em Auth > Settings > Authorized domains.');
                        return;
                    }

                    alert('Erro ao fazer login: ' + error.message);
                });
        }

                // Garantir acesso global para onclick inline
                window.loginWithGoogle = loginWithGoogle;

        // Fun√ß√£o de logout
        function logoutUser() {
            auth.signOut()
                .then(() => {
                    console.log('‚úÖ Usu√°rio deslogado');
                    firebaseCurrentUser = null;
                    firebaseUserToken = null;
                    firebaseUserStatus = null;
                    window.firebaseAuthUser = null;
                })
                .catch((error) => {
                    console.error('‚ùå Erro no logout:', error.message);
                });
        }

        // Monitorar estado de autentica√ß√£o
        auth.onAuthStateChanged(async (user) => {
            const authButtons = document.getElementById('authButtons');
            
            if (user) {
                firebaseCurrentUser = user;
                window.firebaseAuthUser = user;
                
                // Obter token
                firebaseUserToken = await user.getIdToken();
                
                console.log('üë§ Usu√°rio logado:', user.displayName || user.email);
                console.log('üÜî UID:', user.uid);
                
                // Buscar status do backend
                await fetchUserStatus();
                
                // Mostrar informa√ß√µes do usu√°rio
                const statusBadge = firebaseUserStatus?.isPremium 
                    ? '<span style="color: #fbbf24; font-size: 0.9rem;">üíé Premium</span>'
                    : `<span style="color: #9ca3af; font-size: 0.8rem;">${firebaseUserStatus?.remainingToday || 2}/2 hoje</span>`;
                
                authButtons.innerHTML = `
                    <div class="user-dropdown">
                        <button class="user-btn" onclick="toggleUserDropdown()">
                            ${user.photoURL ? `<img src="${user.photoURL}" alt="Avatar" class="user-photo">` : 'üë§'}
                            <div style="display: flex; flex-direction: column; align-items: flex-start; gap: 2px;">
                                <span>${user.displayName || user.email.split('@')[0]}</span>
                                ${statusBadge}
                            </div>
                            ‚ñæ
                        </button>
                        <div class="dropdown-menu" id="userDropdownMenu">
                            <div class="dropdown-user-info">
                                ${user.photoURL ? `<img src="${user.photoURL}" alt="Avatar" class="dropdown-avatar">` : ''}
                                <div>
                                    <div class="dropdown-name">${user.displayName || 'Usu√°rio'}</div>
                                    <div class="dropdown-email">${user.email}</div>
                                </div>
                            </div>
                            <div style="padding: 12px 16px; background: rgba(139, 92, 246, 0.1); border-bottom: 1px solid var(--border-color);">
                                ${firebaseUserStatus?.isPremium 
                                    ? 'üíé <strong>Premium Ativo</strong><br><small>At√© ' + new Date(firebaseUserStatus.premiumUntil).toLocaleDateString('pt-BR') + '</small>'
                                    : `üìä <strong>${firebaseUserStatus?.remainingToday || 2} an√°lises restantes</strong><br><small>Limite di√°rio: 2 an√°lises gr√°tis</small>`
                                }
                            </div>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item" onclick="alert('Em breve: Meu Perfil')">
                                üë§ Meu Perfil
                            </button>
                            <button class="dropdown-item" onclick="alert('Em breve: Ganhos/Perdas')">
                                üìä Ganhos/Perdas
                            </button>
                            ${!firebaseUserStatus?.isPremium ? `
                            <button class="dropdown-item" onclick="alert('Em breve: Upgrade Premium')" style="color: #fbbf24;">
                                üíé Fazer Upgrade
                            </button>
                            ` : ''}
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item logout-item" onclick="logoutUser()">
                                üö™ Sair
                            </button>
                        </div>
                    </div>
                `;
            } else {
                console.log('üö´ Usu√°rio n√£o logado');
                firebaseCurrentUser = null;
                firebaseUserToken = null;
                firebaseUserStatus = null;
                window.firebaseAuthUser = null;
                
                // Mostrar bot√£o de login
                authButtons.innerHTML = `
                    <button class="btn-google" onclick="loginWithGoogle()">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
                        Entrar com Google
                    </button>
                `;
            }
        });

        // Reutilizar fun√ß√£o de toggle dropdown
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdownMenu');
            if (!dropdown) return;
            dropdown.classList.toggle('show');
        }

        // Fechar dropdown ao clicar fora
        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('userDropdownMenu');
            const userBtn = document.querySelector('.user-btn');
            
            if (dropdown && !dropdown.contains(e.target) && e.target !== userBtn) {
                dropdown.classList.remove('show');
            }
        });

        // ============================================
        // SISTEMA DE MATCH CARDS COM PROBABILIDADE
        // ============================================

        // Estado global para controlar expans√£o
        const expandedCards = new Set();

        /**
         * Gera probabilidades adicionais para o bloco expandido
         */
        function generateOtherPredictions(game) {
            const predictions = [];
            
            // Ambas Marcam (BTTS)
            const bttsProb = 45 + Math.random() * 35; // 45-80%
            predictions.push({ label: 'Ambas Marcam', pct: bttsProb.toFixed(1) });
            
            // Over 1.5
            const over15 = 65 + Math.random() * 25; // 65-90%
            predictions.push({ label: 'Over 1.5 Gols', pct: over15.toFixed(1) });
            
            // Over 2.5
            const over25 = 50 + Math.random() * 30; // 50-80%
            predictions.push({ label: 'Over 2.5 Gols', pct: over25.toFixed(1) });
            
            // Casa Vence
            const homeWin = (1 / game.homeOdds) * 100;
            predictions.push({ label: 'Casa Vence', pct: homeWin.toFixed(1) });
            
            // Empate
            const draw = (1 / game.drawOdds) * 100;
            predictions.push({ label: 'Empate', pct: draw.toFixed(1) });
            
            return predictions;
        }

        /**
         * Toggle do bloco de outras probabilidades
         */
        function toggleOtherPredictions(gameId) {
            const list = document.querySelector(`[data-game-id="${gameId}"] .other-predictions-list`);
            const toggle = document.querySelector(`[data-game-id="${gameId}"] .other-predictions-toggle`);
            
            if (list && toggle) {
                list.classList.toggle('expanded');
                toggle.classList.toggle('active');
            }
        }

        /**
         * Toggle do bloco de previs√£o expandido
         */
        function togglePredictionBlock(gameId) {
            const block = document.querySelector(`[data-game-id="${gameId}"] .prediction-block`);
            
            if (!block) return;
            
            if (expandedCards.has(gameId)) {
                expandedCards.delete(gameId);
                block.classList.remove('expanded');
            } else {
                expandedCards.add(gameId);
                block.classList.add('expanded');
            }
        }

        /**
         * Gera probabilidades adicionais para o bloco expandido
         */
        function generateOtherPredictions(game) {
            const predictions = [];
            
            // Ambas Marcam (BTTS)
            const bttsProb = 45 + Math.random() * 35; // 45-80%
            predictions.push({ label: 'Ambas Marcam', pct: bttsProb.toFixed(1) });
            
            // Over 1.5
            const over15 = 65 + Math.random() * 25; // 65-90%
            predictions.push({ label: 'Over 1.5 Gols', pct: over15.toFixed(1) });
            
            // Over 2.5
            const over25 = 50 + Math.random() * 30; // 50-80%
            predictions.push({ label: 'Over 2.5 Gols', pct: over25.toFixed(1) });
            
            // Casa Vence
            const homeWin = (1 / game.homeOdds) * 100;
            predictions.push({ label: 'Casa Vence', pct: homeWin.toFixed(1) });
            
            // Empate
            const draw = (1 / game.drawOdds) * 100;
            predictions.push({ label: 'Empate', pct: draw.toFixed(1) });
            
            // Fora Vence
            const awayWin = (1 / game.awayOdds) * 100;
            predictions.push({ label: 'Fora Vence', pct: awayWin.toFixed(1) });
            
            return predictions;
        }

        /**
         * Toggle do bloco de outras probabilidades
         */
        function toggleOtherPredictions(gameId) {
            const list = document.querySelector(`[data-game-id="${gameId}"] .other-predictions-list`);
            const toggle = document.querySelector(`[data-game-id="${gameId}"] .other-predictions-toggle`);
            
            if (list && toggle) {
                list.classList.toggle('expanded');
                toggle.classList.toggle('active');
            }
        }

        /**
         * Calcula probabilidade baseada em odds e estat√≠sticas
         * Modelo estat√≠stico propriet√°rio
         */
        function calculateProbability(game) {
            // Probabilidade impl√≠cita das odds (odds = 1/probabilidade)
            const homeProb = 1 / game.homeOdds;
            const drawProb = 1 / game.drawOdds;
            const awayProb = 1 / game.awayOdds;
            
            // Remover margem da casa (normalizar para 100%)
            const totalProb = homeProb + drawProb + awayProb;
            const homeReal = (homeProb / totalProb) * 100;
            const drawReal = (drawProb / totalProb) * 100;
            const awayReal = (awayProb / totalProb) * 100;
            
            // An√°lise de mercado (baseada em odds m√©dias)
            const avgOdds = (game.homeOdds + game.drawOdds + game.awayOdds) / 3;
            
            // Identificar melhor mercado
            let market, confidence;
            
            if (avgOdds < 2.5) {
                // Jogo com favorito claro ‚Üí Under
                market = 'Under 2.5';
                confidence = 75 + Math.random() * 20; // 75-95%
            } else if (avgOdds > 3.2) {
                // Jogo equilibrado ‚Üí Over ou BTTS
                market = Math.random() > 0.5 ? 'Over 2.5' : 'Ambas Marcam';
                confidence = 70 + Math.random() * 15; // 70-85%
            } else {
                // Jogo intermedi√°rio ‚Üí an√°lise por odds
                if (homeReal > 55) {
                    market = '1X'; // Casa ou Empate
                    confidence = homeReal + 10;
                } else if (awayReal > 45) {
                    market = 'X2'; // Fora ou Empate
                    confidence = awayReal + 10;
                } else {
                    market = 'Under 3.5';
                    confidence = 80 + Math.random() * 15;
                }
            }
            
            // Ajustar confian√ßa baseada na competi√ß√£o
            if (game.competition.includes('Brasileiro') || game.competition.includes('La Liga')) {
                confidence += 3; // Ligas com mais dados = maior confian√ßa
            }
            
            // Garantir que confian√ßa est√° entre 65% e 98%
            confidence = Math.min(98, Math.max(65, confidence));
            
            return {
                market,
                confidence: confidence.toFixed(1),
                level: confidence >= 85 ? 'high' : confidence >= 75 ? 'medium' : 'low',
                label: confidence >= 85 ? 'ALTA CONFIAN√áA' : confidence >= 75 ? 'M√âDIA CONFIAN√áA' : 'BAIXA CONFIAN√áA'
            };
        }

        /**
         * Renderiza match card
         */
        function renderMatchCard(game, index, isLocked = false) {
            const prediction = calculateProbability(game);
            const otherPredictions = generateOtherPredictions(game);
            
            const cardHTML = `
                <div class="match-card ${isLocked ? 'locked' : ''}" data-game-id="${game.id}">
                    ${isLocked ? `
                    <div class="match-card-overlay">
                        <div class="lock-icon">üîí</div>
                        <div class="unlock-text">
                            Desbloqueie todas as an√°lises<br>com Premium
                        </div>
                        <button class="btn-premium" onclick="alert('Em breve: Upgrade Premium')">
                            üíé Fazer Upgrade
                        </button>
                    </div>
                    ` : ''}
                    
                    <div class="match-header">
                        <span class="league">${game.competition}</span>
                        <span class="match-time">${game.time}</span>
                    </div>

                    <div class="teams">
                        <div class="team">${game.homeTeam}</div>
                        <span class="vs-separator">VS</span>
                        <div class="team">${game.awayTeam}</div>
                    </div>

                    <div class="prediction-box ${prediction.level}">
                        <div class="confidence ${prediction.level}">${prediction.confidence}%</div>
                        <div class="label">${prediction.label}</div>
                        <div class="market">${prediction.market}</div>
                    </div>

                    <div class="buttons">
                        <button class="btn-stats" onclick="togglePredictionBlock(${game.id})">
                            ‚ú® Ver An√°lise Completa
                        </button>
                        <button class="btn-ai" onclick="analyzeWithAI(${game.id})" ${!firebaseCurrentUser ? 'disabled title="Fa√ßa login para usar IA"' : ''}>
                            ü§ñ Analisar com IA
                        </button>
                    </div>

                    <!-- Bloco Expand√≠vel de Previs√£o -->
                    <div class="prediction-block">
                        <div class="prediction-main">
                            <div class="prediction-content">
                                <div class="prediction-market">GOLS: ACIMA/ABAIXO</div>
                                <div class="prediction-pick">${prediction.market}</div>
                            </div>
                            <div class="prediction-badge ${prediction.level}">
                                <div class="badge-pct">${prediction.confidence}%</div>
                                <div class="badge-label">üî• ${prediction.label}</div>
                            </div>
                        </div>

                        <div class="prediction-actions">
                            <button class="btn-action-stats" onclick="showGameStats(${game.id})">
                                üìä Analisar Stats Completo
                            </button>
                            <button class="btn-action-ai" onclick="analyzeWithAI(${game.id})" ${!firebaseCurrentUser ? 'disabled' : ''}>
                                ü§ñ An√°lise com IA Avan√ßada
                            </button>
                        </div>

                        <div class="other-predictions">
                            <div class="other-predictions-header" onclick="toggleOtherPredictions(${game.id})">
                                <span class="other-predictions-title">Outras Probabilidades</span>
                                <span class="other-predictions-toggle">‚ñº</span>
                            </div>
                            <div class="other-predictions-list">
                                ${otherPredictions.map(pred => `
                                    <div class="other-prediction-item">
                                        <span class="other-prediction-label">${pred.label}</span>
                                        <span class="other-prediction-pct">${pred.pct}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return cardHTML;
        }

        /**
         * Renderiza todos os match cards com estrat√©gia de paywall
         */
        function renderMatchCards() {
            if (typeof window.renderGames === 'function') {
                window.renderGames(window.GAMES || []);
                return;
            }

            console.warn('renderGames nao esta disponivel');
        }

        // Garantir acesso global para onclick inline
        window.renderMatchCards = renderMatchCards;

        /**
         * Mostra estat√≠sticas do jogo
         */
        function showGameStats(gameId) {
            const game = GAMES_DATA.find(g => g.id === gameId);
            if (!game) return;
            
            const prediction = calculateProbability(game);
            
            alert(`üìä ESTAT√çSTICAS\n\n` +
                `${game.homeTeam} vs ${game.awayTeam}\n` +
                `${game.competition}\n\n` +
                `üìà MERCADO RECOMENDADO:\n` +
                `${prediction.market} ‚Ä¢ ${prediction.confidence}%\n\n` +
                `üí° ODDS:\n` +
                `Casa: ${game.homeOdds} | Empate: ${game.drawOdds} | Fora: ${game.awayOdds}\n\n` +
                `‚ö†Ô∏è Esta an√°lise √© baseada em modelo estat√≠stico propriet√°rio.`
            );
        }

        /**
         * Analisa jogo com IA
         */
        async function analyzeWithAI(gameId) {
            if (!firebaseCurrentUser) {
                alert('‚ö†Ô∏è Fa√ßa login para usar a an√°lise com IA');
                return;
            }
            
            const game = GAMES_DATA.find(g => g.id === gameId);
            if (!game) return;
            
            const prediction = calculateProbability(game);
            
            // Validar se pode usar an√°lise (chama backend)
            const canUse = await validateAndUseAnalysis();
            if (!canUse) {
                return; // validateAndUseAnalysis j√° mostra o alert
            }
            
            alert(`ü§ñ AN√ÅLISE IA EM DESENVOLVIMENTO\n\n` +
                `${game.homeTeam} vs ${game.awayTeam}\n\n` +
                `Mercado Recomendado: ${prediction.market}\n` +
                `Confian√ßa: ${prediction.confidence}%\n\n` +
                `Em breve: An√°lise completa com IA OpenAI`
            );
        }

    </script>

    <!-- Dados dos Jogos -->
    <script src="games.js"></script>
    
    <script>
        // renderGames eh disparado pelo app.js ao carregar dados
    </script>
</body>
</html>
